/*
 * iSYS4001 Radar Sensor (EEPROM Commands)

 * --------------------------------
 * This sketch demonstrates how to use the EEPROM-related functions of the
 * iSYS4001 radar sensor to manage persistent settings stored in the device.
 * 
 * Functions covered:
 *   - setFactorySettings()      → Restore factory defaults
 *   - saveSensorSettings()      → Save sensor-related configuration
 *   - saveApplicationSettings() → Save application-related configuration
 *   - saveAllSettings()         → Save both sensor + application settings
 * 
 * Hardware Setup:
 *   - Connect the iSYS4001 radar sensor via UART
 *   - For ESP32: Serial2 is used (RX = 16, TX = 17)
 *   - Default radar address is usually 0x80
 */

#include "iSYS4001.h"

// Radar object using ESP32 Serial2 (RX=16, TX=17)
iSYS4001 radar(Serial2, 115200);

// Radar sensor address (typically 0x80, may vary)
const uint8_t RADAR_ADDRESS = 0x80;

// Timeout for EEPROM operations (ms)
const uint32_t EEPROM_TIMEOUT = 500;

/**
 * Helper function to print result of EEPROM commands
 */
void printResult(const char* action, iSYSResult_t result) {
  if (result == ERR_OK) {
    Serial.print("OK \n ");
    Serial.print(action);
    Serial.println(" succeeded");
  } else {
    Serial.print("OK \n");
    Serial.print(action);
    Serial.print(" failed. Error code: 0x");
    Serial.println(result, HEX);
  }
}

void setup() {
  // Initialize debug serial
  Serial.begin(115200);
  Serial.println("\n=== iSYS4001 EEPROM Commands Example ===");

  // Initialize radar UART communication
  Serial2.begin(115200, SERIAL_8N1, 16, 17);

  delay(1000); // Give time for radar to be ready
  Serial.println("Radar communication initialized\n");
}

void loop() {
  iSYSResult_t result;

  // Example 1: Restore factory defaults
  Serial.println("Example 1: Restore factory defaults");
  result = radar.setFactorySettings(RADAR_ADDRESS, EEPROM_TIMEOUT);
  printResult("Restore factory defaults", result);
  delay(2000);

  // Example 2: Save sensor settings
  Serial.println("Example 2: Save sensor settings");
  result = radar.saveSensorSettings(RADAR_ADDRESS, EEPROM_TIMEOUT);
  printResult("Save sensor settings", result);
  delay(2000);

  // Example 3: Save application settings
  Serial.println("Example 3: Save application settings");
  result = radar.saveApplicationSettings(RADAR_ADDRESS, EEPROM_TIMEOUT);
  printResult("Save application settings", result);
  delay(2000);

  // Example 4: Save all settings
  Serial.println("Example 4: Save all settings");
  result = radar.saveAllSettings(RADAR_ADDRESS, EEPROM_TIMEOUT);
  printResult("Save all settings", result);
  delay(2000);

  Serial.println("\nAll EEPROM command examples completed.");
  Serial.println("Restarting in 10 seconds...");
  Serial.println("====================================\n");
  
  delay(10000);  // Wait before restarting loop
}
